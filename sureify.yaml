openapi: 3.1.3
info:
  title: Puddle Data API
  description: |
    Read-only API providing annuity policy data, client profiles, and product options.

    All endpoints return the complete set of records the authenticated user is
    authorized to access. Results are scoped by the caller's authorization context.
  version: 1.0.0
  contact:
    name: Hackathon Team

servers:
  - url: https://hackathon-dev-api.sureify.com/puddle
    description: Development

security:
  - bearerAuth: []

paths:
  /policyData:
    get:
      summary: List all policy data
      description: |
        Returns every annuity policy record the caller is authorized to view,
        including current contract values, rate information, renewal status,
        and the full set of policy features, benefits, riders, and limitations.
      operationId: getPolicyData
      tags: [Policies]
      parameters:
        - $ref: '#/components/parameters/persona'
        - $ref: '#/components/parameters/userId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                required: [policyData]
                properties:
                  policyData:
                    type: array
                    items:
                      $ref: '#/components/schemas/PolicyData'
              example:
                policyData:
                  - ID: "dGVzdC1wb2xpY3ktZGF0YS0x"
                    clientId: "CLT-2024-00100"
                    contractId: "ANN-2020-5621"
                    clientName: "Margaret A. Whitfield"
                    carrier: "Integrity Life Insurance"
                    productName: "SecureChoice Multi-Year Guarantee Annuity"
                    issueDate: "03/15/2018"
                    currentValue: "$180,000"
                    surrenderValue: "$176,400"
                    currentRate: "3.80%"
                    renewalRate: "1.50%"
                    guaranteedMinRate: "1.50%"
                    renewalDate: "03/15/2026"
                    isMinRateRenewal: true
                    suitabilityStatus: "complete"
                    eligibilityStatus: "eligible"
                    features:
                      surrenderCharge: "2.5% (Year 7 of 10)"
                      withdrawalAllowance: "10% annually penalty-free"
                      mvaPenalty: "-3.8% if surrendered today"
                      rateGuarantee: "5 years remaining"
                      features:
                        - name: "Tax-Deferred Growth"
                          description: "Interest compounds tax-deferred until withdrawal"
                          included: true
                          type: "feature"
                        - name: "Nursing Home Waiver"
                          description: "Surrender charges waived after 90-day qualifying stay"
                          included: true
                          type: "feature"
                      benefits:
                        - name: "Guaranteed Minimum Rate"
                          description: "Rate will never fall below 1.50% regardless of market conditions"
                          included: true
                          type: "benefit"
                        - name: "Death Benefit"
                          description: "Full accumulated value paid to beneficiaries upon death"
                          included: true
                          type: "benefit"
                      riders:
                        - name: "Guaranteed Lifetime Withdrawal Benefit"
                          description: "Provides guaranteed income payments for life starting at age 65"
                          included: true
                          type: "rider"
                      limitations:
                        - name: "Market Value Adjustment"
                          description: "Surrender value subject to MVA during surrender charge period"
                          included: true
                          type: "limitation"
                        - name: "Early Withdrawal Penalty"
                          description: "10% IRS penalty applies to withdrawals before age 59 1/2"
                          included: true
                          type: "limitation"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /productOption:
    get:
      summary: List all product options
      description: |
        Returns all annuity product options available in the system. Each
        record describes a product's rate, term, surrender schedule, withdrawal
        provisions, death benefit type, available riders, and the advisor's
        current licensing status for the product.
      operationId: getProductOptions
      tags: [Products]
      parameters:
        - $ref: '#/components/parameters/persona'
        - $ref: '#/components/parameters/userId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                required: [productOptions]
                properties:
                  productOptions:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProductOption'
              example:
                productOptions:
                  - ID: "cHJvZHVjdC1vcHRpb24tMQ"
                    productId: "PROD-FLEXGROWTH-P-7"
                    name: "FlexGrowth Plus MYGA"
                    carrier: "Great American"
                    rate: "4.25%"
                    term: "7 years"
                    premiumBonus: "3.0%"
                    surrenderPeriod: "7"
                    surrenderCharge: "7% (declining 1% annually)"
                    freeWithdrawal: "10%"
                    deathBenefit: "Enhanced -- return of premium plus interest"
                    guaranteedMinRate: "2.50%"
                    riders:
                      - "Guaranteed Lifetime Withdrawal Benefit"
                      - "Nursing Home Confinement Waiver"
                      - "Terminal Illness Waiver"
                    features:
                      - "Tax-deferred accumulation"
                      - "Penalty-free systematic withdrawals"
                      - "Flexible premium payments"
                    liquidity: "10% annual free withdrawal; full liquidity after surrender period"
                    mvaPenalty: "Subject to MVA during surrender period"
                    licensingApproved: true
                    licensingDetails: null
                  - ID: "cHJvZHVjdC1vcHRpb24tMg"
                    productId: "PROD-SAFEHARBOR-F-5"
                    name: "SafeHarbor Fixed Annuity"
                    carrier: "Athene"
                    rate: "3.75%"
                    term: "5 years"
                    premiumBonus: null
                    surrenderPeriod: "5"
                    surrenderCharge: "5% (declining 1% annually)"
                    freeWithdrawal: "10%"
                    deathBenefit: "Standard -- accumulated contract value"
                    guaranteedMinRate: "2.00%"
                    riders:
                      - "Nursing Home Confinement Waiver"
                    features:
                      - "Tax-deferred accumulation"
                      - "No market value adjustment"
                    liquidity: "10% annual free withdrawal; RMD-friendly"
                    mvaPenalty: null
                    licensingApproved: false
                    licensingDetails: "Appointment with Athene required -- apply at carrier portal"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /clientProfile:
    get:
      summary: List all client profiles
      description: |
        Returns all client profile records including financial situation,
        risk parameters, employment and income details, asset information,
        and anticipated changes to the client's financial position. The
        parameters sub-object captures the full comparison parameter set.
      operationId: getClientProfiles
      tags: [Clients]
      parameters:
        - $ref: '#/components/parameters/persona'
        - $ref: '#/components/parameters/userId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                required: [clientProfiles]
                properties:
                  clientProfiles:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClientProfile'
              example:
                clientProfiles:
                  - ID: "Y2xpZW50LXByb2ZpbGUtMQ"
                    clientId: "CLT-2024-00412"
                    clientName: "Margaret A. Whitfield"
                    parameters:
                      residesInNursingHome: "no"
                      hasLongTermCareInsurance: "yes"
                      hasMedicareSupplemental: "yes"
                      grossIncome: "85000"
                      disposableIncome: "45000"
                      taxBracket: "22%"
                      householdLiquidAssets: "250000"
                      monthlyLivingExpenses: "4500"
                      totalAnnuityValue: "180000"
                      householdNetWorth: "650000"
                      anticipateExpenseIncrease: "no"
                      anticipateIncomeDecrease: "yes"
                      anticipateLiquidAssetDecrease: "no"
                      financialObjectives: "Supplement Social Security with guaranteed income; preserve assets for estate"
                      distributionPlan: "Systematic withdrawals beginning at age 67"
                      ownedAssets: "Primary residence (paid off), 401(k), Roth IRA, existing fixed annuity"
                      timeToFirstDistribution: "5 years"
                      expectedHoldingPeriod: "10+ years"
                      sourceOfFunds: "1035 exchange from existing annuity and savings account"
                      employmentStatus: "Employed full-time, plans to retire in 5 years"
                      applyToMeansTestedBenefits: "no"
                      dateOfBirth: "04/12/1960"
                    suitability:
                      clientObjectives: "Supplement Social Security with guaranteed income; preserve assets for estate"
                      riskTolerance: "Conservative"
                      timeHorizon: "5-10 years"
                      liquidityNeeds: "Low -- has separate emergency fund covering 12 months of expenses"
                      taxConsiderations: "Currently in 22% bracket; expects lower bracket in retirement. Tax deferral is valuable."
                      guaranteedIncome: "Desires guaranteed income floor of $2,000/month to supplement Social Security"
                      rateExpectations: "Willing to accept lower current rate for longer rate guarantee period"
                      surrenderTimeline: "No anticipated need to surrender within the next 7 years"
                      livingBenefits:
                        - "Nursing home waiver"
                        - "Terminal illness benefit"
        '401':
          $ref: '#/components/responses/Unauthorized'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        OAuth 2.0 client credentials token. Obtain a token from the Cognito
        token endpoint using `grant_type=client_credentials`.

  parameters:
    persona:
      name: persona
      in: query
      required: true
      schema:
        type: string
        enum: [agent]
      description: Caller persona. Must be "agent".
    userId:
      name: UserID
      in: header
      required: true
      schema:
        type: string
        default: "1001"
      description: User identifier. Must be "1001".

  responses:
    Unauthorized:
      description: Missing or invalid bearer token

  schemas:
    PolicyData:
      type: object
      description: A snapshot of an annuity policy including contract values, interest rates, renewal status, and associated features.
      required:
        - ID
        - clientId
        - contractId
        - clientName
        - carrier
        - productName
        - issueDate
        - currentValue
        - surrenderValue
        - currentRate
        - renewalRate
        - guaranteedMinRate
        - renewalDate
        - isMinRateRenewal
        - suitabilityStatus
        - eligibilityStatus
        - features
      properties:
        ID:
          type: string
          description: Internal record identifier (base64-encoded UUID).
        clientId:
          type: string
          description: Business identifier for the client who owns this policy.
          example: "CLT-2024-00100"
        contractId:
          type: string
          description: Carrier-assigned contract or policy number.
          example: "ANN-2020-5621"
        clientName:
          type: string
          description: Full name of the policy owner.
          example: "Margaret A. Whitfield"
        carrier:
          type: string
          description: Issuing insurance carrier.
          example: "Integrity Life Insurance"
        productName:
          type: string
          description: Name of the annuity product.
          example: "SecureChoice Multi-Year Guarantee Annuity"
        issueDate:
          type: string
          description: Date the contract was issued.
          example: "03/15/2018"
        currentValue:
          type: string
          description: Current accumulated contract value, formatted with currency symbol.
          example: "$180,000"
        surrenderValue:
          type: string
          description: Current cash surrender value after applicable charges.
          example: "$176,400"
        currentRate:
          type: string
          description: Interest rate currently being credited.
          example: "3.80%"
        renewalRate:
          type: string
          description: Rate that will apply at the next renewal period.
          example: "1.50%"
        guaranteedMinRate:
          type: string
          description: Contractual guaranteed minimum interest rate.
          example: "1.50%"
        renewalDate:
          type: string
          description: Date of the next rate renewal.
          example: "03/15/2026"
        isMinRateRenewal:
          type: boolean
          description: Whether the renewal rate equals the guaranteed minimum.
        suitabilityStatus:
          type: string
          description: Current state of the suitability review for this policy.
          enum: [complete, incomplete, not-started]
        eligibilityStatus:
          type: string
          description: Whether the policy is eligible for renewal or exchange activity.
          enum: [eligible, restricted, ineligible]
        features:
          $ref: '#/components/schemas/PolicyFeaturesData'

    PolicyFeaturesData:
      type: object
      description: Feature, benefit, rider, and limitation details associated with a policy, plus summary contract provisions.
      properties:
        surrenderCharge:
          type: string
          nullable: true
          description: Current surrender charge percentage and schedule position.
          example: "2.5% (Year 7 of 10)"
        withdrawalAllowance:
          type: string
          nullable: true
          description: Penalty-free withdrawal provision.
          example: "10% annually penalty-free"
        mvaPenalty:
          type: string
          nullable: true
          description: Current market value adjustment impact if surrendered today.
          example: "-3.8% if surrendered today"
        rateGuarantee:
          type: string
          nullable: true
          description: Remaining duration of the current rate guarantee period.
          example: "5 years remaining"
        features:
          type: array
          description: Product features included with the contract.
          items:
            $ref: '#/components/schemas/PolicyFeature'
        benefits:
          type: array
          description: Contractual benefits provided by the policy.
          items:
            $ref: '#/components/schemas/PolicyFeature'
        riders:
          type: array
          description: Optional riders attached to the policy.
          items:
            $ref: '#/components/schemas/PolicyFeature'
        limitations:
          type: array
          description: Contractual restrictions and limitations.
          items:
            $ref: '#/components/schemas/PolicyFeature'

    PolicyFeature:
      type: object
      description: A single feature, benefit, rider, or limitation associated with a policy.
      required: [name, description, included, type]
      properties:
        name:
          type: string
          description: Display name of the feature.
          example: "Nursing Home Waiver"
        description:
          type: string
          description: Explanation of the feature and its terms.
          example: "Surrender charges waived after 90-day qualifying stay"
        included:
          type: boolean
          description: Whether this feature is active on the policy.
        type:
          type: string
          description: Classification of the feature.
          enum: [feature, benefit, rider, limitation]

    ProductOption:
      type: object
      description: An available annuity product with rate, term, surrender schedule, benefit provisions, and the advisor's licensing status.
      required:
        - ID
        - productId
        - name
        - carrier
        - rate
        - term
        - surrenderPeriod
        - freeWithdrawal
        - deathBenefit
        - guaranteedMinRate
      properties:
        ID:
          type: string
          description: Internal record identifier (base64-encoded UUID).
        productId:
          type: string
          description: Business identifier that correlates this option with a visualization product.
          example: "PROD-FLEXGROWTH-P-7"
        name:
          type: string
          description: Product marketing name.
          example: "FlexGrowth Plus MYGA"
        carrier:
          type: string
          description: Issuing insurance carrier.
          example: "Great American"
        rate:
          type: string
          description: Current credited interest rate.
          example: "4.25%"
        term:
          type: string
          description: Rate guarantee term length.
          example: "7 years"
        premiumBonus:
          type: string
          nullable: true
          description: First-year premium bonus percentage, if offered.
          example: "3.0%"
        surrenderPeriod:
          type: string
          description: Number of years the surrender charge schedule applies.
          example: "7"
        surrenderCharge:
          type: string
          nullable: true
          description: Current surrender charge schedule.
          example: "7% (declining 1% annually)"
        freeWithdrawal:
          type: string
          description: Annual penalty-free withdrawal percentage.
          example: "10%"
        deathBenefit:
          type: string
          description: Type of death benefit provided.
          example: "Enhanced -- return of premium plus interest"
        guaranteedMinRate:
          type: string
          description: Contractual guaranteed minimum interest rate.
          example: "2.50%"
        riders:
          type: array
          nullable: true
          description: Optional riders available or attached.
          items:
            type: string
          example:
            - "Guaranteed Lifetime Withdrawal Benefit"
            - "Nursing Home Confinement Waiver"
        features:
          type: array
          nullable: true
          description: Included product features.
          items:
            type: string
          example:
            - "Tax-deferred accumulation"
            - "Penalty-free systematic withdrawals"
        liquidity:
          type: string
          nullable: true
          description: Summary of the product's liquidity provisions.
          example: "10% annual free withdrawal; full liquidity after surrender period"
        mvaPenalty:
          type: string
          nullable: true
          description: Whether the product is subject to a market value adjustment.
          example: "Subject to MVA during surrender period"
        licensingApproved:
          type: boolean
          nullable: true
          description: Whether the requesting advisor is licensed and appointed to sell this product.
        licensingDetails:
          type: string
          nullable: true
          description: Additional licensing status details or required actions.
          example: "Appointment with carrier required -- apply at carrier portal"

    ClientProfile:
      type: object
      description: A client's identifying information and comprehensive financial profile used for comparison and assessment.
      required: [ID, clientId, clientName, parameters]
      properties:
        ID:
          type: string
          description: Internal record identifier (base64-encoded UUID).
        clientId:
          type: string
          description: Business identifier for the client.
          example: "CLT-2024-00412"
        clientName:
          type: string
          description: Full name of the client.
          example: "Margaret A. Whitfield"
        parameters:
          $ref: '#/components/schemas/ComparisonParameters'
        suitability:
          nullable: true
          description: Suitability assessment data for this client, if available.
          allOf:
            - $ref: '#/components/schemas/SuitabilityInlineData'

    ComparisonParameters:
      type: object
      description: |
        Financial situation, anticipated changes, objectives, and planning
        parameters for a client. All fields are optional and represented as
        strings for display flexibility.
      properties:
        residesInNursingHome:
          type: string
          nullable: true
          description: Whether the client currently resides in a nursing home.
          enum: ["yes", "no"]
        hasLongTermCareInsurance:
          type: string
          nullable: true
          description: Whether the client has long-term care insurance.
          enum: ["yes", "no"]
        hasMedicareSupplemental:
          type: string
          nullable: true
          description: Whether the client has Medicare supplemental coverage.
          enum: ["yes", "no"]
        grossIncome:
          type: string
          nullable: true
          description: Annual gross income.
          example: "85000"
        disposableIncome:
          type: string
          nullable: true
          description: Annual disposable income after essential expenses and taxes.
          example: "45000"
        taxBracket:
          type: string
          nullable: true
          description: Current federal income tax bracket.
          example: "22%"
        householdLiquidAssets:
          type: string
          nullable: true
          description: Total liquid assets (cash, savings, money market).
          example: "250000"
        monthlyLivingExpenses:
          type: string
          nullable: true
          description: Average monthly living expenses.
          example: "4500"
        totalAnnuityValue:
          type: string
          nullable: true
          description: Total value of all annuity contracts held.
          example: "180000"
        householdNetWorth:
          type: string
          nullable: true
          description: Total household net worth.
          example: "650000"
        anticipateExpenseIncrease:
          type: string
          nullable: true
          description: Whether the client anticipates a significant expense increase.
          enum: ["yes", "no"]
        anticipateIncomeDecrease:
          type: string
          nullable: true
          description: Whether the client anticipates an income decrease (e.g., retirement).
          enum: ["yes", "no"]
        anticipateLiquidAssetDecrease:
          type: string
          nullable: true
          description: Whether the client anticipates a decrease in liquid assets.
          enum: ["yes", "no"]
        financialObjectives:
          type: string
          nullable: true
          description: Client's stated financial goals and objectives.
          example: "Supplement Social Security with guaranteed income; preserve assets for estate"
        distributionPlan:
          type: string
          nullable: true
          description: Planned distribution or withdrawal strategy.
          example: "Systematic withdrawals beginning at age 67"
        ownedAssets:
          type: string
          nullable: true
          description: Summary of major owned assets.
          example: "Primary residence (paid off), 401(k), Roth IRA, existing fixed annuity"
        timeToFirstDistribution:
          type: string
          nullable: true
          description: Expected time until the first distribution from the annuity.
          example: "5 years"
        expectedHoldingPeriod:
          type: string
          nullable: true
          description: Expected total holding period for the annuity.
          example: "10+ years"
        sourceOfFunds:
          type: string
          nullable: true
          description: Source of funds for the annuity purchase.
          example: "1035 exchange from existing annuity and savings account"
        employmentStatus:
          type: string
          nullable: true
          description: Current employment status and retirement plans.
          example: "Employed full-time, plans to retire in 5 years"
        applyToMeansTestedBenefits:
          type: string
          nullable: true
          description: Whether the client expects to apply for means-tested government benefits.
          enum: ["yes", "no"]
        dateOfBirth:
          type: string
          nullable: true
          description: Client's date of birth in MM/DD/YYYY format.
          example: "04/12/1960"

    SuitabilityInlineData:
      type: object
      description: Suitability assessment fields embedded in a client profile response.
      required:
        - clientObjectives
        - riskTolerance
        - timeHorizon
        - liquidityNeeds
        - taxConsiderations
        - guaranteedIncome
        - rateExpectations
        - surrenderTimeline
        - livingBenefits
      properties:
        clientObjectives:
          type: string
          description: Summary of the client's stated financial objectives.
        riskTolerance:
          type: string
          description: Client's self-assessed risk tolerance level.
        timeHorizon:
          type: string
          description: Expected investment time horizon.
        liquidityNeeds:
          type: string
          description: Assessment of the client's need for accessible funds.
        taxConsiderations:
          type: string
          description: Relevant tax situation and planning considerations.
        guaranteedIncome:
          type: string
          description: Client's desired guaranteed income provisions.
        rateExpectations:
          type: string
          description: Client's rate and return expectations or preferences.
        surrenderTimeline:
          type: string
          description: Whether or when the client anticipates surrendering the contract.
        livingBenefits:
          type: array
          description: Living benefit features important to the client.
          items:
            type: string
